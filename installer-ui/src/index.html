<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Schemock Installer</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="installer-container">
        <header class="installer-header">
            <h1>
                üöÄ Schemock Installer
                <span class="version">v1.0.0</span>
            </h1>
            <div class="header-actions">
                <span id="status-text">Ready</span>
            </div>
        </header>

        <!-- Welcome Page -->
        <div id="welcome-page" class="installer-content active welcome-page">
            <div class="logo">Schemock</div>
            <div class="subtitle">Mock Server Generator</div>
            <div class="description">
                Welcome to the Schemock installation wizard. This will guide you through the installation process 
                of Schemock Mock Server Generator on your Windows system.
            </div>
            
            <div class="system-requirements">
                <h3>System Requirements</h3>
                <ul>
                    <li><span class="requirement-check">‚úì</span> Windows 10 or later (x64)</li>
                    <li><span class="requirement-check">‚úì</span> 512MB RAM minimum</li>
                    <li><span class="requirement-check">‚úì</span> 100MB free disk space</li>
                </ul>
            </div>
        </div>

        <!-- Installation Path Page -->
        <div id="path-page" class="installer-content">
            <h2>Installation Location</h2>
            <p>Choose the folder where you want to install Schemock:</p>
            
            <div class="form-group">
                <label for="install-path">Installation Path:</label>
                <div class="path-browse">
                    <input type="text" id="install-path" class="form-control path-input" value="C:\Program Files\Schemock">
                    <button class="browse-btn" onclick="browsePath()">Browse...</button>
                </div>
            </div>
            
            <div class="form-group">
                <label>Available Space: <span id="available-space">Checking...</span></label>
                <label>Required Space: 100MB</label>
            </div>
        </div>

        <!-- Components Selection Page -->
        <div id="components-page" class="installer-content">
            <h2>Select Components</h2>
            <p>Choose which components to install:</p>
            
            <div class="component-list">
                <div class="component-item">
                    <input type="checkbox" id="component-core" class="component-checkbox" checked disabled>
                    <label for="component-core" class="component-name">Schemock Core Application</label>
                    <span class="component-size">73MB</span>
                </div>
                
                <div class="component-item">
                    <input type="checkbox" id="component-docs" class="component-checkbox" checked>
                    <label for="component-docs" class="component-name">Documentation</label>
                    <span class="component-size">5MB</span>
                </div>
                
                <div class="component-item">
                    <input type="checkbox" id="component-examples" class="component-checkbox" checked>
                    <label for="component-examples" class="component-name">Example Schemas</label>
                    <span class="component-size">1MB</span>
                </div>
                
                <div class="component-item">
                    <input type="checkbox" id="component-start-menu" class="component-checkbox" checked>
                    <label for="component-start-menu" class="component-name">Start Menu Shortcuts</label>
                    <span class="component-size">< 1MB</span>
                </div>
                
                <div class="component-item">
                    <input type="checkbox" id="component-desktop" class="component-checkbox" checked>
                    <label for="component-desktop" class="component-name">Desktop Shortcut</label>
                    <span class="component-size">< 1MB</span>
                </div>
            </div>
        </div>

        <!-- Summary Page -->
        <div id="summary-page" class="installer-content summary-page">
            <h2>Ready to Install</h2>
            <p>Please review the installation summary below:</p>
            
            <div class="summary-section">
                <h3>Installation Details</h3>
                <div class="summary-details">
                    <p><strong>Version:</strong> <span id="summary-version">1.0.0</span></p>
                    <p><strong>Location:</strong> <span id="summary-path">C:\Program Files\Schemock</span></p>
                    <p><strong>Components:</strong> <span id="summary-components">All selected</span></p>
                </div>
            </div>
            
            <div class="summary-section">
                <h3>System Requirements</h3>
                <div class="summary-details">
                    <p><strong>OS:</strong> Windows 10 or later</p>
                    <p><strong>Architecture:</strong> x64</p>
                    <p><strong>Memory:</strong> 512MB RAM minimum</p>
                    <p><strong>Disk Space:</strong> 100MB required</p>
                </div>
            </div>
        </div>

        <!-- Installation Progress Page -->
        <div id="installation-page" class="installer-content installation-page">
            <div class="installation-icon">‚öôÔ∏è</div>
            <div class="installation-status">Installing Schemock...</div>
            <div class="installation-message" id="installation-message">Preparing installation...</div>
            
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill">
                        <span class="progress-text" id="progress-text">0%</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Success Page -->
        <div id="success-page" class="installer-content success-page">
            <div class="success-icon">‚úÖ</div>
            <div class="success-title">Installation Complete!</div>
            <div class="success-message">
                Schemock has been successfully installed on your system. You can now start using it immediately 
                from the Start Menu or Desktop shortcuts.
            </div>
            <div class="success-actions">
                <button class="btn btn-primary" onclick="launchApplication()">Launch Schemock</button>
                <button class="btn btn-secondary" onclick="closeInstaller()">Close</button>
            </div>
        </div>

        <footer class="installer-footer">
            <div class="navigation-buttons">
                <button id="btn-back" class="btn btn-secondary" onclick="navigateBack()" style="display: none;">Back</button>
                <button id="btn-next" class="btn btn-primary" onclick="navigateNext()">Next</button>
                <button id="btn-cancel" class="btn btn-secondary" onclick="cancelInstallation()">Cancel</button>
                <button id="btn-install" class="btn btn-primary" onclick="startInstallation()" style="display: none;">Install</button>
            </div>
            <div class="footer-info">
                <span>¬© 2023 Schemock Team. All rights reserved.</span>
            </div>
        </footer>
    </div>

    <script>
        const { ipcRenderer } = require('electron');
        
        let currentPage = 'welcome';
        let appConfig = {};
        let installerState = {};
        
        // Page navigation
        const pages = ['welcome', 'path', 'components', 'summary', 'installation', 'success'];
        let currentPageIndex = 0;

        // Initialize
        async function init() {
            try {
                appConfig = await ipcRenderer.invoke('get-app-config');
                installerState = await ipcRenderer.invoke('get-installer-state');
                document.getElementById('install-path').value = installerState.installPath || 'C:\\Program Files\\Schemock';
                updateUI();
            } catch (error) {
                console.error('Failed to initialize:', error);
            }
        }

        function updateUI() {
            // Update header
            document.getElementById('status-text').textContent = currentPage.charAt(0).toUpperCase() + currentPage.slice(1);
            
            // Update navigation buttons
            updateNavigationButtons();
            
            // Update component states
            updateComponentStates();
        }

        function updateNavigationButtons() {
            const btnBack = document.getElementById('btn-back');
            const btnNext = document.getElementById('btn-next');
            const btnInstall = document.getElementById('btn-install');
            const btnCancel = document.getElementById('btn-cancel');
            
            // Hide all buttons first
            btnBack.style.display = 'none';
            btnNext.style.display = 'none';
            btnInstall.style.display = 'none';
            
            switch (currentPage) {
                case 'welcome':
                    btnNext.style.display = 'inline-block';
                    btnCancel.style.display = 'inline-block';
                    break;
                case 'path':
                    btnBack.style.display = 'inline-block';
                    btnNext.style.display = 'inline-block';
                    btnCancel.style.display = 'inline-block';
                    break;
                case 'components':
                    btnBack.style.display = 'inline-block';
                    btnNext.style.display = 'inline-block';
                    btnCancel.style.display = 'inline-block';
                    break;
                case 'summary':
                    btnBack.style.display = 'inline-block';
                    btnInstall.style.display = 'inline-block';
                    btnCancel.style.display = 'inline-block';
                    break;
                case 'installation':
                    btnCancel.style.display = 'inline-block';
                    break;
                case 'success':
                    btnCancel.style.display = 'inline-block';
                    break;
            }
        }

        function updateComponentStates() {
            if (installerState.selectedComponents) {
                document.getElementById('component-docs').checked = installerState.selectedComponents.documentation;
                document.getElementById('component-examples').checked = installerState.selectedComponents.examples;
                document.getElementById('component-start-menu').checked = installerState.selectedComponents.startMenu;
                document.getElementById('component-desktop').checked = installerState.selectedComponents.desktopShortcut;
            }
        }

        function navigateTo(page) {
            // Hide current page
            document.querySelectorAll('.installer-content').forEach(el => {
                el.classList.remove('active');
            });
            
            // Show new page
            document.getElementById(page + '-page').classList.add('active');
            
            currentPage = page;
            updateUI();
            
            // Update summary if navigating to summary
            if (page === 'summary') {
                updateSummary();
            }
            
            // Notify main process
            ipcRenderer.invoke('navigate-to', page);
        }

        function navigateBack() {
            if (currentPageIndex > 0) {
                currentPageIndex--;
                navigateTo(pages[currentPageIndex]);
            }
        }

        function navigateNext() {
            if (currentPageIndex < pages.length - 1) {
                // Validate current page before proceeding
                if (validateCurrentPage()) {
                    currentPageIndex++;
                    navigateTo(pages[currentPageIndex]);
                }
            }
        }

        function validateCurrentPage() {
            switch (currentPage) {
                case 'path':
                    const installPath = document.getElementById('install-path').value;
                    if (!installPath || installPath.trim() === '') {
                        showMessage('error', 'Installation Path', 'Please select a valid installation path.');
                        return false;
                    }
                    return true;
                default:
                    return true;
            }
        }

        function updateSummary() {
            const installPath = document.getElementById('install-path').value;
            document.getElementById('summary-version').textContent = appConfig.version;
            document.getElementById('summary-path').textContent = installPath;
            
            const selectedComponents = [];
            if (document.getElementById('component-docs').checked) selectedComponents.push('Documentation');
            if (document.getElementById('component-examples').checked) selectedComponents.push('Examples');
            if (document.getElementById('component-start-menu').checked) selectedComponents.push('Start Menu');
            if (document.getElementById('component-desktop').checked) selectedComponents.push('Desktop');
            
            document.getElementById('summary-components').textContent = 
                selectedComponents.length === 0 ? 'None selected' : selectedComponents.join(', ');
        }

        async function startInstallation() {
            try {
                // Save current settings
                const installPath = document.getElementById('install-path').value;
                const components = {
                    documentation: document.getElementById('component-docs').checked,
                    examples: document.getElementById('component-examples').checked,
                    startMenu: document.getElementById('component-start-menu').checked,
                    desktopShortcut: document.getElementById('component-desktop').checked
                };
                
                await ipcRenderer.invoke('set-install-path', installPath);
                await ipcRenderer.invoke('set-components', components);
                
                navigateTo('installation');
                
                // Start installation
                const result = await ipcRenderer.invoke('start-installation');
                
            } catch (error) {
                showMessage('error', 'Installation Failed', `Installation failed: ${error.message}`);
            }
        }

        async function browsePath() {
            try {
                const path = await ipcRenderer.invoke('browse-install-path');
                if (path) {
                    document.getElementById('install-path').value = path;
                }
            } catch (error) {
                showMessage('error', 'Browse Error', `Failed to browse: ${error.message}`);
            }
        }

        function launchApplication() {
            const { shell } = require('electron');
            shell.openExternal('schemock:');
        }

        function closeInstaller() {
            window.close();
        }

        function cancelInstallation() {
            if (currentPage === 'installation') {
                showMessage('warning', 'Cancel Installation', 
                    'Are you sure you want to cancel the installation? The application will not be properly installed.',
                    ['Yes', 'No']
                ).then(result => {
                    if (result.response === 0) {
                        window.close();
                    }
                });
            } else {
                window.close();
            }
        }

        async function showMessage(type, title, message, buttons = ['OK']) {
            const result = await ipcRenderer.invoke('show-message-box', {
                type: type,
                title: title,
                message: message,
                buttons: buttons
            });
            return result;
        }

        // IPC event handlers
        ipcRenderer.on('installation-progress', (event, { progress, message }) => {
            document.getElementById('progress-fill').style.width = progress + '%';
            document.getElementById('progress-text').textContent = progress + '%';
            document.getElementById('installation-message').textContent = message;
        });

        ipcRenderer.on('installation-complete', (event, { success }) => {
            if (success) {
                navigateTo('success');
            } else {
                showMessage('error', 'Installation Failed', 
                    'The installation could not be completed. Please check the logs and try again.');
            }
        });

        // Initialize the app
        init();
    </script>
</body>
</html>